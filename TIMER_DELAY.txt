#include "stm32f1xx.h"

void delay_ms(uint16_t ms)
{
	 TIM3 ->ARR=ms;
	 TIM3 ->EGR =1;
	 TIM3 ->CR1|=TIM_CR1_CEN;
	 while(!(TIM3 ->SR & TIM_SR_UIF));
     TIM3 ->SR &= ~TIM_SR_UIF;
}

int main()
{
	// configure gpio C13 pushpull output
		RCC->APB2ENR |= 1<<4;
		GPIOC->CRH |= (1<<21);
		GPIOC->CRH &= ~((1<<22)|(1<<23));

	RCC->APB1ENR|=RCC_APB1ENR_TIM3EN;
	TIM3->PSC=8000;
	TIM3->CR1|=TIM_CR1_ARPE;
	TIM3->CR1|=TIM_CR1_OPM | TIM_CR1_URS ;
    while(1)
    {
    	GPIOC->BSRR = 1<<13;
    		delay_ms(1000);
    		GPIOC->BSRR = 1<<(13+16);
    		delay_ms(1000);
    }
}
